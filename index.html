<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Relate</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #111;
      color: #fff;
    }
    .screen { display: none; }
    .active { display: block; }
    input, button {
      padding: 8px;
      margin: 8px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #ffcc00;
      cursor: pointer;
    }
    canvas {
      background: #222;
      margin-top: 20px;
      border: 1px solid #444;
    }
  </style>
</head>
<body>

  <!-- Screen 1 -->
  <div id="screen1" class="screen active">
    <h2>Enter Your Name</h2>
    <input id="usernameInput" placeholder="Your name">
    <button id="enterBtn">Enter</button>
  </div>

  <!-- Screen 2 -->
  <div id="screen2" class="screen">
    <h2>Welcome, <span id="displayName"></span>!</h2>
    <p>Search for a friend:</p>
    <input id="searchInput" placeholder="Friend name">
    <button id="searchBtn">Search</button>
    <div id="searchResult"></div>
    <br>
    <button id="mapBtn">View Relationship Map</button>
  </div>

  <!-- Screen 3 -->
  <div id="screen3" class="screen">
    <h2>Relationship Map</h2>
    <canvas id="map" width="600" height="400"></canvas><br>
    <button id="backBtn">Back</button>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem('users')) || [];
    let currentUser = null;

    function showScreen(num) {
      document.querySelectorAll('.screen').forEach((s, i) => {
        s.classList.toggle('active', i === num - 1);
      });
    }

    function enterApp() {
      const name = document.getElementById('usernameInput').value.trim();
      if (!name) return alert('Enter your name');
      let user = users.find(u => u.name === name);
      if (!user) {
        user = { name, friends: [] };
        users.push(user);
        localStorage.setItem('users', JSON.stringify(users));
      }
      currentUser = user;
      document.getElementById('displayName').textContent = name;
      showScreen(2);
    }

    function searchUser() {
      const searchName = document.getElementById('searchInput').value.trim();
      const result = document.getElementById('searchResult');
      if (!searchName) return result.textContent = "Enter a name.";
      const found = users.find(u => u.name === searchName);
      if (!found) return result.textContent = "User not found.";
      if (found.name === currentUser.name) return result.textContent = "That's you!";
      const existing = currentUser.friends.find(f => f.name === found.name);
      if (existing) return result.textContent = `${found.name} is already your ${existing.relation}.`;
      const relation = prompt(`Enter your relationship with ${found.name}:`);
      if (!relation) return;
      currentUser.friends.push({ name: found.name, relation });
      found.friends.push({ name: currentUser.name, relation });
      localStorage.setItem('users', JSON.stringify(users));
      result.textContent = `${found.name} added as ${relation}.`;
    }

    function drawMap() {
      const canvas = document.getElementById('map');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (!currentUser || currentUser.friends.length === 0) {
        ctx.fillStyle = '#fff';
        ctx.fillText("No friends yet!", 260, 200);
        return;
      }
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      ctx.fillStyle = '#ffcc00';
      ctx.beginPath();
      ctx.arc(centerX, centerY, 30, 0, 2 * Math.PI);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.fillText(currentUser.name, centerX - 15, centerY + 5);
      const count = currentUser.friends.length;
      const radius = 120;
      const angleStep = (2 * Math.PI) / count;
      currentUser.friends.forEach((f, i) => {
        const angle = i * angleStep;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        ctx.strokeStyle = f.relation.toLowerCase() === "friend" ? "yellow" :
                          f.relation.toLowerCase() === "enemy" ? "red" :
                          f.relation.toLowerCase() === "crush" ? "pink" : "lightblue";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(x, y, 20, 0, 2 * Math.PI);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.fillText(f.name, x - 10, y + 5);
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('enterBtn').addEventListener('click', enterApp);
      document.getElementById('searchBtn').addEventListener('click', searchUser);
      document.getElementById('mapBtn').addEventListener('click', () => showScreen(3));
      document.getElementById('backBtn').addEventListener('click', () => showScreen(2));
    });
  </script>

</body>
</html>
